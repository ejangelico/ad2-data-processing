#NOTE - software channels in ad2_reduction and struck_reduction must be unique identifiers of the channel.
#cannot have a copy of channel 1, for example, listed in both ad2 software channels and struck channel_numbers. 
#they will be overwritten in the reduced_df dataframe. 


#reduction / processing parameters related to files generated by the analog discovery 2 digitizer
ad2_reduction:
  #each ad2 digitizer, if multiple, is represented by a prefix here. In Run 5 and 6, we only use one AD2. 
  #note some important differences: the sample rate and timing of the event changes on an event by event basis
  #if the settings change during data logging (which sometimes happens). They are parsed in the header of the file. 
  "glitch": #file prefix before timestamp
    channel_map:
      ad2_channel: [0,1] #which channel indexed in NGMStruckBinaryFile object
      prereduced_index: [0,1] #which index in the prereduced row["Data"] = [[stream0], [stream1], ...] object
      software_channel: [2,3] #a unique identifier across all DAQ systems for the channel. 

    filter_tau: 5 #microseconds gaussian filter smoothing time constant, 0 for no filtering
    exponential_tau: 100 #microseconds, exponential decay of integrator circuit
    no_pulse_threshold: 0 #if max-sample is less than this, don't integrate
    #this variable governs whether (1) a pulse is determined as possibly existing from raw waveform
    #(2) whether the pulse is detected by a gaussian filtered algorithm that attempts to find peaks
    fit_amplitude_threshold: 5 #3*std of baseline, a.k.a "noise" variable
    integration_window: [-0.8, 1] #us, skip integrating the baseline samples, just integrate this window about peak time.
    baseline_window: [-1, -0.8] #us, region over which to calculate mean of baseline 
    fit_mode: False #NOT IMPLEMENTED, performs a fit with N exponentials where N is the number of peaks found in the waveform. 



struck_reduction:
  prefix: "pmts" #this prefix will be attached to dataframe columns associated with this digitizer for later reduction stage. 
  #this replaces the channel map file functionality of the NGMBinaryFile reading. 
  channel_map:
    card: [0,0,0] #which card is it on, unique to Struck
    struck_channel: [0,1,3] #which channel indexed in NGMStruckBinaryFile object
    prereduced_index: [0,1,2] #which index in the prereduced row["Data"] = [[stream0], [stream1], ...] object
    software_channel: [0,1,4] #a unique identifier across all DAQ systems for the channel. 

  events_per_file: 500 #number of events to chunkify the data into for saving to pickle files during binary processing. 
  clock: 125e6 #Hz clock rate. 
  mv_per_adc: 0.03 
  no_pulse_threshold: 15 #mV, amplitude to discard the event as having nothing
  baseline_window: [0, 40] #number of samples over which to calc baseline
  pulseheight_window: [40, 60] #the region where the primary pulse lands due to trigger timing
  afterpulse_window: [65, 1000] #the region after the primary pulse where afterpulsing may occur. 
  
  #the struck C++ code that writes a datetime to the filename
  #has a constant offset that is wierd. Use this to correct that timestamp
  timestamp_offset: -28800 #seconds to add to the filename timestamps on struck files. Note! daylight savings time!

  impedance: 25 #ohms, it was set to 50 ohms on struck and we have 50 ohms in the discriminators. 

#info for voltage reconstruction. These are assumed to be in the dataset location
ramp_name: "ramp.txt"
dataset_name: "ds" #this prefix distinguishes a dataset that is used for HV phenomena testing as opposed to say, filter testing, or filling/emptying. 
calib_path: "calibrations/" #assumed relative path from topdir in Dataset.py or RunX from AnalysisTools.
g_events_name: "g_events.txt"
struck_folder: "struck/"
rog_gap: 0.285 #cm, gap between rogowskis nominally.
rog_cap: 20 #pF

month: "12" #for a stupid reason, I can't put the month or year into the AD2 datafile names and its needed for good date parsing. 
year: "2023"

